# CPCEC -- http://cngsoft.no-ip.org/cpcec.htm #

	  ####  ######    ####  #######   ####   -------------------------
	 ##  ##  ##  ##  ##  ##  ##   #  ##  ##  CPCEC, plain text Amstrad
	##       ##  ## ##       ## #   ##       CPC emulator written in C
	##       #####  ##       ####   ##       as a postgraduate project
	##       ##     ##       ## #   ##       by Cesar Nicolas-Gonzalez
	 ##  ##  ##      ##  ##  ##   #  ##  ##  since 2018-12-01 till now
	  ####  ####      ####  #######   ####   -------------------------

## Foreword ##

CPCEC is an emulator of the family of home microcomputers Amstrad CPC (models
464, 664, 6128, Plus and GX4000) whose goal is to be loyal to the original
hardware and efficient in standard modern systems. Thus it brings a faithful
emulation of the Z80 microprocessor and it replicates the behavior of the CRTC
6845 and Gate Array video chips, the PSG AY-3-8912 sound chip, the remaining
circuits found in the original hardware, and the tape deck and floppy disc drive
that made possible loading and running software.

Software and documentation are provided "as is" with no warranty. The source
code of CPCEC and its binaries follow the GNU General Public License v3, as seen
in the file GPL.TXT within the package.

## Requirements and setup ##

The default build of CPCEC requires a Microsoft Windows 2000 operating system or
later, while the SDL2 build requires any operating system supported by the SDL2
library. The minimal hardware requirements are those fitting the operating
system, and it's advised that the main microprocessor runs at 400 MHz at least.
Screen resolution in pixels must be 800x600 at least. A sound card is optional.
Using a joystick is optional, too.

The emulator spans several files: the runnable binaries CPCEC.EXE and ZXSEC.EXE
for Windows, CPCEC.ELF and ZXSEC.ELF for GNU/Linux, and the firmware files
CPC464.ROM, CPC664.ROM, CPC6128.ROM, CPCADOS.ROM, CPCPLUS.ROM, SPEC128K.ROM,
SPEC-P-2.ROM, SPEC-P-3.ROM and SPECTRUM.ROM. All these files must be copied in a
single directory, ideally created to host the emulator.

The binaries can be compiled from the source files by following the instructions
in the next paragraphs. GCC 4.9.2, GCC 5.1.0, Pelles 4.50.113 and TCC 0.9.27
work correctly; GCC 4.7.1 makes severe mistakes in compilation and generates
invalid binaries.

The Windows binaries can be compiled from GCC (or compatible) through the
following commands:

	windres cpcec.rc -Ocoff -ocpcec.res
	gcc -m32 -mwindows cpcec.res -O2 -xc cpcec.c -luser32 -lgdi32 -lwinmm
-lcomdlg32 -lshell32 -ocpcec.exe

	windres zxsec.rc -Ocoff -ozxsec.res
	gcc -m32 -mwindows zxsec.res -O2 -xc zxsec.c -luser32 -lgdi32 -lwinmm
-lcomdlg32 -lshell32 -ozxsec.exe

Pelles C and other visual compilers can define the whole project from the source
files CPCEC.C and ZXSEC.C and the resource files CPCEC.RC and ZXSEC.RC, and
guess the additional files on their own (icons and header files) while the
libraries required for the compiling procedure (if the compiler doesn't
recognize them on its own) are USER32, GDI32, WINMM, COMDLG32 and SHELL32, all
them from the Win32 SDK.

The binaries for operating systems supported by SDL2 need different commands:

	gcc -DSDL_MAIN_HANDLED -O2 -xc cpcec.c -lSDL2 -ocpcec.elf

	gcc -DSDL_MAIN_HANDLED -O2 -xc zxsec.c -lSDL2 -ozxsec.elf

(besides, the filenames must be in lower case: the contents of the ZIP archive
must be extracted with "unzip -LL cpcec-20XXXXXX.zip")

## Configuration and files ##

The behavior of CPCEC can be configured by specifying optional parameters in the
command line. It's convenient to keep the user's preferred parameters by
creating a link or shortcut to the emulator in the system menu and including
said parameters within the link. Options can be abridged in Unix style: for
example `-C -d -J` becomes `-CdJ`. In case of doubt, the parameter `-h` shows a
short help explaining the available options.

* -C0 : display the screen in black and white;
* -C1 : display the screen in dark colour;
* -C2 : display the screen in full colour (by default);
* -C3 : display the screen in bright colour;
* -C4 : display the screen in levels of green;
* -c0 : set the scanline mode to half;
* -c1 : set the scanline mode to whole (by default);
* -c2 : set the interlace mode to simple;
* -c3 : set the interlace mode to double;
* -d : start the emulation with the debugger on (by default off);
* -g0, -g1, -g2, -g3, -g4 : set the CRTC type (by default 1);
* -h : short help;
* -j : enable emulation of joystick on keyboard (cursors and keys Z, X and C);
* -J : disable the usage of a joystick plugged to the system;
* -K, -k0 : emulate 64k RAM only
* -k1 : emulate 128k RAM (by default);
* -k2 : emulate 192k RAM;
* -k3 : emulate 320k RAM;
* -k4 : emulate 576k RAM;
* -m0 : start emulation as an Amstrad CPC 464;
* -m1 : start emulation as an Amstrad CPC 664;
* -m2 : start emulation as an Amstrad CPC 6128, by default;
* -m3 : start emulation as an Amstrad Plus (Plus 464, Plus 6128 and GX4000 only
differ in the amount of RAM, the disc controller and the keyboard);
* -O : hide onscreen indicators (by default shown);
* -R : disable real time emulation (by default enabled);
* -S : disable sound (by default enabled if there's a sound card);
* -T : disable stereophony (by default enabled);
* -W : use the full screen rather than a window;
* -X : disable emulation of disc drives (by default enabled);
* -Y : disable tape analysis (by default enabled; see below);
* -Z : disable tape acceleration (by default enabled);
* -! : hide menu and make the emulation fully keyboard-driven.

It's also possible to add file names to the command line: the emulator will try
opening and running the specified files. Thanks to it CPCEC can be linked to the
file extensions CDT, CPR, CSW, DSK and SNA to automatically load said files.

The file types supported by the emulator are divided in three types:

* WAV, CSW and CDT: tape files, or more properly digital dumps of the contents
of a magnetic tape used to store and distribute data and software.
* DSK: disc files, virtual translations of the structure and contents of a
magnetic floppy disc able to contain data and software.
* SNA: "snapshots", integral copies of the state of an emulated system that make
possible resuming in a later time said state of emulation.

Tape playback relies on two methods (enabled by default) to improve the user
experience by shortening a procedure that was originally very slow: a typical
programme on tape took five minutes to load. The first method (tape
acceleration) simply detects whether there's a tape in and the cassette motor is
active: in that case the emulator starts running at its maximum possible speed.
The second method (tape analysis) examines the current state of the Z80 and
detects whether it's trying to read the tape in a known way: in that case it
modifies its state to instantly generate the playback results instead of waiting
for the tape to raise the next signal.

Automatic loading of disc files tries detecting on its own the required booting
method. Because some discs had more than one possible booting point and the
emulator is in risk of choosing an unwanted one, the user can choose it on his
own by typing the command `RUN"FILENAME` (where FILENAME is the booting file,
that is often specified in the software instructions, or be simply DISC or DISK)
in the emulated system and pressing RETURN. In case of doubt, the command CAT
shows the list of files stored inside the disc.

## Function keys ##

Once it's running, CPCEC shows the screen of the emulated system and obeys the
user's commands, that besides those belonging to said system (control and
alphanumeric keypresses, motions of the joystick, either real or emulated
through the keyboard) include a series of special function keys. In case of
doubt, key F1 shows a short index of these function keys.

* F1: short help;
* F1+Control: emulator authorship;
* F2: record the emulation's current state into a snapshot;
* F2+Control: record again the last selected snapshot;
* F3: load and run a tape file, disc file, snapshot or cartridge;
* F3+Control: load again the last selected snapshot;
* F4: enable (or disable) sound emulation;
* F4+Control: enable (or disable) the keyboard-emulated joystick;
* F5: choose the emulated CPC firmware, that can be a ROM file, an INI file or a
CPR-formatted cartridge;
* F5+Control: reset the emulation;
* F6: enable (or disable) realtime emulation;
* F6+Control: raise the speed of the emulated Z80 from 4 MHz to 8, 12 and 16
MHz;
* F6+Control+Shift: lower its speed to 12, 8 and 4 MHz;
* F7: insert a disc file into the virtual disc drive A;
* F7+Shift: insert a disc file into the virtual disc drive B;
* F7+Control: remove the disc from the virtual disc drive A;
* F7+Control+Shift: remove the disc from the virtual disc drive B;
* F8: insert a tape file in the virtual tape deck;
* F8+Shift: start recording a new tape file;
* F8+Control: remove the tape from the virtual tape deck;
* F9: enable the debugger (see below);
* F9+Shift: show (or hide) the onscreen indicators;
* F9+Control: enable (or disable) tape acceleration;
* F9+Control+Shift: enable (or disable) tape analysis;
* F11: toggle the colour mode between monochrome, green and three levels of
colour of increasing brightness;
* F11+Shift: ditto in reverse, moving through decreasing brightness colour
levels;
* F11+Control: change the type of scanlines, from half scanlines to double
interlace;
* F11+Control+Shift: ditto in reverse, from double interlace to half scanlines;
* F12: record the content of the screen into a BMP file;
* F12+Control: start recording (or stop) the sound into a WAV file;
* F12+Control+Shift: start recording (or stop) the sound into a YM file;
* Pause: stop (or resume) emulation;
* Alt+Return: maximize (or restore) the window. The menu becomes hidden when
maximizing the window with these keys.

SDL2-based versions are slightly different because they provide their own
graphical interface; the menu shows up when the user presses F10, and to change
the disc file access mode the user must press TAB within the file selection
dialog shown by F7 or F7+Shift.

Files BMP and WAV are the namesake standard files of image and sound. YM files
are dumps of the sound chip states, that because of their usage in other
platforms besides the Amstrad CPC (Spectrum 128, MSX, Atari ST...) can be
emulated and played back independently in third party programmes such as STSOUND
and AY-EMUL. Notice that the scanline mode (option that simulates several types
of screen) mirrors itself on the recordings as well as on the screen, and that
each mode has a different impact on the programme performance: the normal mode
consumes the most processing power, and the double interlace, the least.

INI files can be used to define a "profile", a set of extra ROMs to load on top
of the current firmware. Internally they're simple text files where each line is
either LOWEST=filename (that sets the LOW ROM content) or HIGHxx=filename (that
sets the n-th HIGH ROM slot content, where "n" is the hexadecimal value of
"xx"): for example HIGH07=PARADOS.ROM means that slot 7 of HIGH ROM is occupied
by the file PARADOS.ROM.

The onscreen indicators show the state of the disc drives (track number, busy or
idle), the tape deck (busy or idle) and the joystick.

The following keys adjust the frameskip: the higher this parameter, the lower
the required processing power, but also the lower the visual smoothness. Ideally
it should keep its value to 0 unless 1.- the system lacks enough processing
power, or 2.- the user needs to speed the emulation up for a while.

* Num.+ : increases the value of frameskip, up to 25;
* Num.- : decreases the value of frameskip, down to 0;
* Num.* : sets the value of frameskip to the maximum, 25;
* Num./ : sets the value of frameskip to the minimum, 0.

The menu also includes several additional options (for example CRTC type) as
well as actions such as browsing the contents of the current tape.

CPCEC supports drag-and-drop. Dropped files will be automatically loaded (as F3
does) unless the Shift key is down; in this case they will be inserted as F7 and
F8 do.

ZIP archives can be read by CPCEC (if there are more than one file inside, a
list will be shown so the user can choose the required file) but their contents
cannot be modified.

## Debugger ##

The debugger is used to stop the emulation and examine its internal state. It
was originally based on a command line interface; it has since been updated into
a cursor-driven user interface divided into four panels: disassembly (top left),
registers (top right), memory dump (bottom left) and stack (bottom right). The
left half (read only) of the registers panel shows the hardware registers (Gate
Array, CRTC, etc.) while the right half (read-write) shows the Z80 registers
proper. The values shown on screen and the command parameters use hexadecimal
notation.

* Cursors, Page Up and Page Down move the cursor within the current panel;
* Tab (or Shift+Tab) move the cursor to the next (or previous) panel;
* Digits from 0 to 9 and letters from A to F modify the value under the cursor;
* G ("go to") requests an address (in hexadecimal) and moves the cursor to its
location in the disassembly or the memory dump;
* H shows a short help;
* I ("input") requests a filename and loads its contents onto memory starting
from the current location of the cursor;
* J ("jump to") sets the PC to the location under the cursor in the disassembly;
* L ("log") requests an 8-bit register (B, C, D, E, H, L, F or A) and sets a
special breakpoint in the current instruction under the cursor; from then on,
whenever that instruction takes place, the value of the 8-bit register will be
sent to a log file first chosen by the user;
	+ K closes the log file;
* M toggles the contents of the memory dump between what the Z80 can read (RAM
or ROM; the separator between hexadecimal and ASCII fields is `/`) and what it
can write (RAM only; the separator is `\`);
* O ("output") requests a length in bytes and a filename, and creates a file
with a memory dump starting from the current location of the cursor;
* P ("print") requests a length in bytes and a filename, and creates a file with
a disassembly starting from the current location of the cursor;
* R ("run to") runs the emulation until reaching the operation under the cursor
in the disassembly;
* S ("search") requests either an ASCII string (case insensitive) or a
hexadecimal string with a prefix (for example `SOS` becomes `$534F53`) and
searches the memory for it since the current location until the last valid
address. If it finds the string it moves the cursor next to it in either the
disassembly or the memory dump;
	+ N ("next") searches again the memory for the same string;
* T ("toggle") creates or deletes a breakpoint in the current cursor location in
the disassembly;
* U ("return") resumes the emulation until reaching the current call's return
address;
* V changes the debugger appearance, toggling black or white colours and thin or
bold characters;
* X toggles the classic/Plus hardware information panel;
* Z deletes all breakpoints;
* Space ("step into") runs exactly one operation and stops on the next
operation;
	+ Shift+Space runs operations during one whole scanline;
* Return ("step over") resumes the emulation until reaching the next operation.
It behaves differently from SPACE if the current instruction performs a call;
* Escape stops the debugger and resumes the emulation.

Usage of upper and lower case is unimportant; the debugger isn't case sensitive.

## ZXSEC ##

ZXSEC is an emulator of the Sinclair Spectrum family (48k, 128k, +2/Plus2 and
+3/Plus3) based on the components it shared with the Amstrad CPC family: the Z80
microprocessor, the PSG AY-3-8192 sound chip, the tape system and the NEC765
disc drive controller.

It spans the files ZXSEC.EXE, SPECTRUM.ROM, SPEC128K.ROM, SPEC-P-2.ROM and
SPEC-P-3.ROM, and otherwise runs the same as CPCEC, with several differences:

* option -mX chooses one out of four possible models: -m0 (48k), -m1 (128k), -m2
(+2) or -m3 (+3).
* option -K disables the PSG AY-3-8912 sound chip (enabled by default) if the
chosen model is Spectrum 48k;
* option -X disables the disc drives if the chosen model is Spectrum +3, that
thus becomes a +2A instead;
* Control+Shift+F8 starts (or stops) the cassette motor, because the CPC
hardware includes a built-in tape control, while the Spectrum hardware lacks it.
* joystick options apply to the Sinclair 2 interface by default; the menu allows
choosing the type of joystick.

ZXSEC can show Gigascreen effects (for example the demo "Mescaline Synesthesia"
2009 DeMarche) if the user enables the interlace options in the Video menu.

## Acknowledgements ##

This emulator owes its existence to a series of people and societies that are
listed as follows:

* The firmware files included in the package are Amstrad's properties, who
allows the emulation of their old computer systems and supports the distribution
of their firmwares as long as their authorship and contents are respected, and
whom I wholeheartedly thank for the creation of those magnificent computers and
the good will towards their emulation.
* This emulator was my final project for the Computer Engineering postdegree at
the Distance-Learning National University (Universidad Nacional de Enseñanza a
Distancia, UNED), a project directed by professor José Manuel Díaz Martínez and
ultimately awarded a 100% and the right to a honorable mention.
* The documentation about the system comes from cpcwiki.eu, cpc-power.com,
cpcrulez.fr and quasar.cpcscene.net.
* The alpha tests were handled by the faithful and loyal Denis Lechevalier.

## Appendix: test cases ##

The following list states the one hundred titles that made the bulk of the
emulator tests during its development. Several titles span more than one test
(for example "Donkey Kong" is both a protected tape and a middle case of
multiple image modes at once); they're mentioned in the first type of test.

Diagnostics:

* Z80 Instruction Exerciser ZEXALL (2004 public domain)
* PLUSTEST (2002 Richard Wilson)

Simple cases:

* Sultan's Maze / Laberinto del Sultán (1984 Gem Software / Amsoft)
* Oh Mummy (1984 Gem Software / Amsoft)
* Roland on the Ropes / Fred (1984 Indescomp / Amsoft)
* Roland in the Caves / La Pulga (1984 Indescomp / Amsoft)

Tape files:

* Unprotected:
	+ Roland in Time (1984 Gem Software / Amsoft)
	+ Manic Miner (1985 Software Projects / Amsoft)
	+ Jet Set Willy (1985 Software Projects / Amsoft)
	+ Knight Lore (1985 Ultimate)
	+ Alien 8 (1986 Ultimate)
* Simple protections:
	+ Technician Ted (1985 Hewson)
	+ Abu Simbel Profanation (1986 Dinamic)
	+ Deflektor (1987 Costa Panayi / Gremlin Graphics)
	+ Desperado (1987 Topo Soft)
	+ Humphrey (1988 Made in Spain / Zigurat)
* Middle protections:
	+ Donkey Kong (1986 Arcana / Ocean)
	+ MASK (1987 Gremlin Graphics)
	+ Operation Wolf (1988 Imagine)
	+ Rainbow Islands (1989 Graftgold / Ocean)
* Complex protections:
	+ Rasputin (1985 Paul Hibbard / Firebird)
	+ Spiky Harold (1985 A.Rogers / Firebird)
	+ Druid (1986 Firebird)
	+ Split Personalities (1986 Domark)
	+ Last Mission (1986 Opera Soft)
	+ Marmalade (1987 MBC Informatique)
	+ Gonzzálezz (1989 Opera Soft)
	+ Twinworld (1990 Ubi Soft)

Strange cases:

* Z80:
	+ Sabre Wulf (1985 Ultimate)
	+ Bigfoot (1989 Codemasters)
* PIO:
	+ Nodes of Yesod (1986 Odin)
	+ Prehistorik (1991 Titus)
	+ Antiriad / Sacred Armour of Antiriad (1987 Palace Software)
* Ports:
	+ Skweek (1989 Loriciels)
	+ Night Shift (1990 Lucasarts)
	+ Hero Quest (1991 Gremlin Graphics)

Middle cases:

* Multiple image modes or colour palettes at once:
	+ Sorcery (1985 Gang of Five / Virgin Games)
	+ Kong Strikes Back (1985 Ocean)
	+ Crafton & Xunk (1986 Ere Software)
	+ Elite (1986 Bell and Braben / Firebird)
	+ Amaurote (1987 Binary Design / Mastertronic)
	+ Feud (1987 Binary Design / Mastertronic)
	+ Gauntlet (1987 Gremlin Graphics)
	+ Renegade (1987 Arcana / Imagine)
* Fast smooth hardware scroll:
	+ TLL / Tornado Low Level (1985 Vortex Software)
	+ Thing on a Spring (1986 Gremlin Graphics)
	+ Ghosts'n Goblins (1986 Elite)
	+ Prohibition (1987 Infogrames)
* Screen bigger than usual (overscan):
	+ Arkanoid (1987 Probe / Imagine)
	+ Arkanoid 2: Revenge of Doh (1988 Imagine)
* Hardware double buffer:
	+ Sol Negro (1988 Opera Soft)
	+ Mutan Zone (1988 Opera Soft)
	+ Rescate Atlántida (1989 Creep Soft / Dinamic)
	+ AMC / Astro Marine Corps (1989 Creep Soft / Dinamic)
* Sampled sound:
	+ Enigma de Aceps (1986 ACE Software)
	+ Dragon Ninja (1988 Imagine)
	+ Robocop (1988 Ocean)

Disc files:

* CP/M 2.2 (1984 Digital Research / Amstrad)
* CP/M Plus (1985 Digital Research / Amstrad)
* Abadía del Crimen (1987 Opera Soft)
* Corsarios (1990 Opera Soft)
* Ghostbusters 2 (1989 Software Studios / Activision)
* SWIV (1991 Storm / Sales Curve)
* Addams Family / La familia Addams (1991 Ocean)
* 5KB Demo 3 (1999 Duncan + LBB)

Advanced cases:

* Mission Genocide (1987 Paul Shirley / Firebird)
* Warhawk (1987 Proteus / Firebird)
* Dynamic Duo (1988 Probe / Firebird)
* Rastan (1988 Probe / Imagine)
* Skateball (1988 Ubi Soft)
* Turrican (1990 Probe / Rainbow Arts)

Amstrad Plus:

* Arnold 5 Diagnostic Rom Version 1.3 (1990 Amstrad)
* Burnin' Rubber (1990 Ocean)
* Navy Seals (1990 Ocean)
* Copter 271 (1991 Loriciel)
* Fire 'n Forget 2 (1990 Titus)
* Dick Tracy (1991 Titus)
* No Exit (1990 Coktel Vision)
* Robocop 2 (1990 Ocean)
* Switchblade (1990 Gremlin Graphics)
* World of Sports (1990 Epyx)
* 1st Plus Demo (1991 GPA)
* Eerie Forest (2017 Logon System)

Very advanced cases:

* Turrican 2 (1991 Enigma Variations / Rainbow Arts)
* Facehugger Megademo (1991 Face Hugger)
* Zap't'Balls (1992 Amstrad CPC International)
* Super Cauldron (1992 Titus)
* Prodatron Megademo (1992 Prodatron)
* Prehistorik 2 (1993 Titus)
* Voyage '93 (1993 BENG)
* Overflow 5 Previews (1994 Overflow)
* Big'O Full'O Dem'O (1998 Arkos)
* Byte '98 (1999 Mortel & Overlanders)
* École Buissonière (2000 Overlanders)
* DTC (2006 Arkos)
* Orion Prime (2009 Cargosoft)
* Edge Grinder (2011 Cosine & Format War)
* Batman Returns (2011 Batman Group)
* Bloc Us (2011 Benediction)
* Super Edge Grinder (2012 Cosine & Format War)
* R-Type 128 (2012 Easter Egg)
* Still Rising (2013 Vanity)
* Yet Another Plasma! (2012 Logon System)
* Breaking Baud (2015 CRTC & 3LN)
* Megablasters: Escape from Castle in the Clouds (2015 Project Argon)
* Imperial Mahjong (2016 Cargosoft)
* Logon's Run (2017 Logon System)
* Wunderbar (2017 Arkos & Benediction)
* Isometrikum (2018 Vanity)
* Still Scrolling (2018 Music2Eye & Praline)
* PhX (2018 Condense)

## Version log ##

- 20190314 -- first public release.
- 20190317 -- second public release. Fixed Win32 joystick bugs: JoyGetPos
returns ZERO on OK, not on ERROR.
- 20190318 -- third public release. By default the window shows a menu; new
option -+ hides it.
- 20190325 -- fourth public release. Onscreen indicators (hide them with -O);
fixed bugs in ZXSEC that slowed emulation down when the frameskip wasn't zero,
and another bug in audio recording on WAV files.
- 20190331 -- fifth public release. Tapes can be browsed, either by file
position (WAV and CSW) or by block (CDT, TZX and TAP).
- 20190404 -- sixth public release. Fixed a Z80 emulation bug in IRQ logic.
Configuration (computer model and file paths) is kept across sessions in a INI
file.
- 20190408 -- seventh public release. Fixed a bug in the YM3 file recording,
another one in the ZXSEC internal timings, and one more in the debugger commands
with optional parameters.
- 20190419 -- eighth public release. Added options for image and sound
interpolation; tape automatically rewinds itself when it reaches the end (à la
FUSE); fixed a bug in TZX files that store 0 instead of 8 in the "used bits"
field, another bug in CUSTOM INFO blocks in TZX files, and another one when
ZXSEC loads a 48K SNA file in Plus3 mode (users should manually switch to a safe
model beforehand anyway). INI files now remember the names of the last used
files.
- 20190430 -- ninth public release. Softer B/W Spectrum palette; fixed bug in
FDC sector size calculation if GAP datas are stored (Loriciels' discs); added
simple memory contention to ZXSEC ("Amaurote", "Black Lamp", "Puzznic", "Sly
Spy", "Zub"...).
- 20190524 -- tenth public release. Added support for CDT/TZX file blocks 0x24
and 0x25 (loop start and ending) (cfr. BATMAN.TZX), fixed bugs in the handling
of weak sectors in DSK files (cfr. "Titus Classiques"), YM file recording is
reentrant, fixed a bug in INI files with empty fields and added the option
`autorewind <0|1>` to rewind (or remove) a tape when playback reaches the end.
- 20190526 -- minor patch fixing a bug in autorun mode: opening menus and
switching windows cancelled the automatic keyboard.
- 20190731 -- eleventh public release. Added a new UI-based debugger (typing
commands is no longer needed) and support for ZIP archive reading based on
PUFF.C from the ZLIB project, upgraded GCC to 5.1.0 and removed all `inline`
tags (they did more harm than good), and generally reworked all internals to
make them OS-independent. Several details improved as well: the file selector
fixes a bug in Win10 (and in some cases in Win7), "browse tape" dialog shows the
file name, Spectrum +3 automatically becomes +2A to load tapes, `auto rewind`
shows up in Edit menu and fixes bugs in CSW files, and sound emulation has
improved, for example "Terminus" on CPC plays sound and "Agent X II" on Spectrum
is no longer noisy.
- 20190809 -- minor patch restoring the "silent" discarding (i.e. without error
codes) of write operations in read-only discs and allowing the automatic booting
of IBM-formatted discs.
- 20190817 -- minor patch fixing a crash when booting tapes right when the
automatic frameskip kicks in.
- 20190831 -- minor patch fixing several bugs (booting two-sided discs with FLIP
SIDE option on, recording snapshots or tapes after loading a snapshot or tape
from a ZIP archive), improving several details (loading snapshots with memory
compression, emulating up to 576 kB RAM) and redefining the menus (Edit is
divided into Edit and Settings, Image and Sound become Video and Audio, new
video filter functions...) and the command line: "-+" now limits the zoom to
integer values; "-!" inherits the option of hiding the menu.
- 20191003 -- twelfth public release. Precise (albeit not perfect yet) memory
contention and ULA noise ("snow") on Spectrum: "48K Timing Tests" passes all
tests but 36 and 37, and "128K Timing Tests" fails on just six tests. "Mask 3:
Venom Strikes Back" draws the attribute and border effects on their precise
locations on all platforms (48K, 128K/Plus2, Plus3) and Software Creations'
"Black Lamp", "LED Storm" and "Sly Spy" behave well on 128K machines.
Improvements in the debugger: fixed disassembly panel invalid cursor locations,
added optional tall characters, avoided debug+pause clashing, new key M toggles
memory dump ROM+RAM and RAM-only modes. Improved ZIP handling (ZIP archives are
no longer locked, files within archives are filtered by extension), user
interface fixes.
- 20191004 -- minor patch making the debugger options set with V and M stick
between sessions.
- 20191117 -- thirteenth public release. More precise emulation of type 1 CRTC
(by default instead of 0) in CPCEC ("From Scratch", "Pinball Dreams"...) and 48K
memory contention in ZXSEC ("Starion", "Black Lamp"...). CPCEC also allows
choosing the length of the V-hold signal (for example "Thunder Blade" needs a
short signal) and whether horizontal sync must be flexible ("Batman Returns",
"Pinball Dreams"...) or not ("CPC 30th Anniversary Megademo", "PhX").
Unfortunately, some demos that worked well in past versions now suffer problems
that cannot be solved by selecting another CRTC. Removed third joystick button
in CPCEC, no real joystick ever included it. The ZXSEC joystick is Sinclair 2 by
default.
- 20191130 -- minor patch fixing a bug when running CPCEC and ZXSEC on a screen
shorter than 600 px, another one when recording a WAV file, and another one in
the port logic of CPCEC ("Knight Rider", OUT &0088,&88 must not reach the Gate
Array, but "Hero Quest", OUT &00C0,&C0 must reach it). The CRTC types 0 and 2
have improved ("Face Hugger Ultimate Megademo: Tantrum", "5KB Megademo 3",
"Power System Megademo: Glooms"...) but cannot handle "Pinball Dreams" yet,
unlike CRTC 3 and 4, that together with CRTC 1 support this game now.
- 20191227 -- fourteenth public release. Visual improvements: the green screen
palette is closer to the original, the vertical filters ("Y-Masking") are
compatible with the interlaced modes, mixing X-Masking and Y-Masking together
shows a checkered pattern. Internal improvements: the new traits of the CRTC
registers 3 and 9 and the delays between the Gate Array, the Z80 and the CRTC
finally can emulate "Pinball Dreams" as a whole for all the CRTC types and solve
the problems in several demos ("Scroll Factory", "Still Rising", parts of "The
Demo"...) and games ("Action Fighter", "Storm Warrior", "Usagi Yojimbo"),
although some titles still need particular CRTCs ("PhX" CRTC0, "Onescreen
Colonies" CRTC1, etc.) to work correctly.
- 20191231 -- minor patch fixing a bug in the FDC (bit 6 of SENSE DRIVE STATUS
must react when the user changes discs: "Fugitif") and a regression in CRTC0
(detect REG6<REG4 rather than REG6<=REG4: "5KB Megademo 3: Nayad"). Happy new
year 2020!
- 20200101 -- minor patch fixing a regression in CRTC0 caused by the previous
patch ("Scroll Factory", intro of "Pinball Dreams", "Overflow Preview: Part 1")
and improving its heuristics ("Overflow Preview: Part 3").
- 20200229 -- fifteenth public release. Added support for Amstrad Plus hardware:
extended colours, soft scrolling, hardware sprites, programmable raster
interruptions, DMA channels, ROM cartridges, etc. Added fifty more tape schemes
to speed up the reading of bytes and even whole blocks. Improvements in the disc
drive emulation: new discs (by default the DATA format shared by CPC and
Spectrum +3) can be created on the fly, emulation of protected games from Design
Design ("2112 AD"), The Edge ("Palitron"), Titus ("Prehistorik" and
"Moktar/Titus the Fox"), bugfixes (READ ID: "5KB Demo 3", "Daley Thompson's
Olympic Challenge" and "Turbo Copy III"; FORMAT TRACK converts old-style MV -
CPC discs into new-style EXTENDED ones, and cleans up useless data at the end of
the disc). CPCEC honours the RAM size (up to 576k) and CRTC type stated by a
snapshot ("Postscript" demo) and so does ZXSEC, that can read Z80 snapshots now
and allows 48K SNA files to be either strict (the original format) or relaxed:
128K headers on 48K data. Control-F2 avoids accidental recording of snapshots
after a reset. Fixed a bug that happened when combining Y-Masking and Half
Scanlines. Extended ZIP archive support to handle pipeline-generated (i.e. the
final headers are the right ones) archives. Sources are distributed together
with the binaries instead of being delivered upon demand.
- 20200307 -- minor patch avoiding a hang in globbing(), improving snapshot
compatibility (WinAPE and ACE employ slightly different CPC+ blocks) and
removing several useless details. The optional firmware packages now include the
corresponding cartridges.
- 20200314 -- first anniversary! minor patch fixing issues in the Plus demos
"CRTC3" and "Eerie Forest" for Amstrad Plus.
- 20200331 -- minor patch providing further fixes for Plus demos "CRTC3" and
"Synergy 4" (top left sprites disappear after few seconds, though) and adding
the command Shift+Space (skip scanline) to the debugger.
- 20200404 -- minor patch fixing the DMA handler (all commands but LOAD can be
combined together) and removing several "kludges" for PLUS but the one for
"Black Sabbath": thanks to Norecess464 for locating the bug. Also, -C now
becomes -C0..4.
- 20200406 -- minor patch adding partially multiplexed PLUS sprite rendering:
"Synergy 4" recovers its top left sprites.
- 20200418 -- minor patch with improvements in the interrupt counter (it starts
with the first HSYNC fall after the VSYNC rise -"Onescreen Colonies"- unless on
PLUS where it can start when the VSYNC rise happens together with the HSYNC
fall: "Black Sabbath"), the hardware ports (PIO port A returns zero when reading
it in write mode unless on PLUS where it returns 255 -"Tire au Flan"-, PIO port
B must set VSYNC in the middle of the screen when the CRTC requests it -"Chany
Dream End Megademo"- and the Gate Array's 0-191 byte range requires a more rigid
port logic -"Overflow Preview 3"-) and the debugger: disassembly parameters are
vertically aligned and the hardware information panel is aligned to the ASCII
memory dump. Fixed a bug in the ZIP archive header seeker, too.
- 20200420 -- minor patch fixing the HSYNC signals' black stripes from "Chany
Dream End Megademo" on CRTC 1, "Onescreen Colonies" on CRTC 0, etc., as well as
the value of MEMPTR in JR cc,$RR and DJNZ $RR and the logic of BIT n,r,(IX+$XX):
the error rates of ZXSEC in the 2012 RAXOFT tests are Z80FULL 10/152, Z80CCF
70/152 and Z80MEMPTR 4/152.
- 20200430 -- sixteenth public release. Now you can compile CPCEC and ZXSEC with
SDL2 (featuring its own graphical user interface) for multiple operating systems
thru the option -DSDL_MAIN_HANDLED; the precompiled files CPCEC.ELF and
ZXSEC.ELF for 32bit GNU/Linux are included, too. New support for extended ROM
profiles through INI files enumerating up to 257 16K ROM blocks. Further Z80
tweaks: the new error rates of ZXSEC in the 2012 RAXOFT tests are 8/152 Z80FULL,
5/152 Z80CCF and 0/152 Z80MEMPTR.
- 20200503 -- minor patch improving the behavior of the Z80 operations INI, IND,
INIR, INDR, OUTI, OUTD, OTIR and OTIR: the 2012 RAXOFT tests (Z80CCF, Z80FULL
and Z80MEMPTR) score zero errors. Slightly more precise automatic frameskip.
- 20200505 -- minor patch focused on the SDL2 toolkit: fixed a bug when
confirming overwriting files, and improved file browsing across directories by
pointing by default to the previous directory.
- 20200509 -- minor patch improving the synchrony between Z80 and video on
ZXSEC: the ULA48 test already worked before, but ULA128 had problems; now both
work well. Added the option -W (use the full screen rather than a window) and
improved the SDL2 handling of bigger windows.
- 20200603 -- seventeenth public release. Added stereo sound. Fixed a bug in the
CPC PIO (the read-only mode of port A allowed writing), another bug in the tape
analysis (CPCEC: the algorithm for TITUS caused trouble in "The Blues Brothers";
ZXSEC: Speedlock5 didn't recognize the heading noise; both systems add patches
to shorten the initial delays), another one in the loading of CPC snapshots (a
snapshot saved on PLUS hardware without the "CPC+" block showed a completely
black palette), another one in the Z80 debugger (the command 'P0 could generate
an infinite disassembly), another one on tape handling (reading a WAV file must
use >128 as reference instead of >=128) and some problems in Win32 (the screen
stopped updating after pausing, switching windows in and out) and SDL2 (boot
message errors weren't shown; the filename sorting algorithm was slow).
- 20200606 -- minor patch with surround sound: the user can set the channel
separation to 0% (mono), 50% (surround) or 100% (stereo).
- 20200616 -- minor patch adding several tape analyses and removing the patch
that shortened the initial delays (it caused problems). Several changes in SDL2
(fewer warnings, disc drive cache in Win32) and in the Z80 debugger (more
content: 256 bytes of memory dump and 32 bytes of stack).
- 20200622 -- minor patch reducing memory footprint (extra ROM memory is only
allocated if the user loads a "profile"), rendering SYNC signals as black rather
than as the current border, and fixing the 3D cylinders part of "PhX" on CRTC1;
the "ball worms" and the final scroller stay bad on CRTC3 and CRTC4, though.
